
import rlp

from hexbytes import HexBytes

# uip modules
from uiputils.uiperror import Missing

from uiputils.eth.tools import AbiEncoder
from uiputils.eth.tools import FileLoad, JsonRPC

ENC = 'utf-8'


class InsuranceSmartContract:
    def __init__(
        self,
        msg=None,
        signature=None,
        owners=None,
        ves=None,
        contract_addr=None
    ):
        # TODO : contract construct
        if contract_addr is None:
            if msg is None or signature is None or owners is None or ves is None:
                self.address = None
            else:
                print(msg)
                print(signature)
                # encoded_data = AbiEncoder.encodes(
                #     [owners, [0, 0, 0], msg, signature, 3],
                #     ['address[]', 'uint256[]', 'bytes', 'bytes', 'uint256']
                # )
                # bytescode = FileLoad.getbytecode('../nsb-isc/nsbisc.bin')
                # ves.unlockself()
                # print(encoded_data)
                # print(len(HexBytes(bytescode) + HexBytes(encoded_data)))
                # tx_json = JsonRPC.eth_send_transaction({
                #     'from': ves.address,
                #     'data': str(bytescode.decode(ENC)) + encoded_data,
                #     'gas': hex(5000000)
                # })
                # print(tx_json)
                # response = JsonRPC.send(tx_json, rpc_host=ves.chain_host)
                # print(response)
        else:
            self.address = contract_addr
        # self.contract =
        self.owners = owners
        # self.handle = ethISC(...)
        # Insurance Smart Contract is a contract on the blockchain
        pass

    def update_funds(self, owner, fund):
        if owner not in self.owners:
            raise Missing('this address is not owner')
        print(owner, "updated fund:", fund)

    def insurance_claim(self, contract_id, atte):
        pass

    def settle_contract(self, contract_id):
        pass
# 0x842453b97eb8742178d6af105bdb5bb9340c058e8a6a1d0aedba5f73f15424e80a1da8896cbe9eac968ee75c89a4d5238fb83e501b527e1956f51c81d94e247301
# ["0xca35b7d915458ef540ade6068dfe2f44e8fa733c","0x14723a09acff6d2a60dcdf7aa4aff308fddc160c"],["0","0"],"0x19457468657265756d205369676e6564204d6573736167653a0a33313233","0x842453b97eb8742178d6af105bdb5bb9340c058e8a6a1d0aedba5f73f15424e80a1da8896cbe9eac968ee75c89a4d5238fb83e501b527e1956f51c81d94e247301","0x21dfbe1c391b2ff861cb3163e70bf1b4c80b61f77f91cbe198967917cd9a22d5","1"
# ["0x4f984aa7d262372df92f85af9be8d2df09ac4018", "0x47a1cdb6594d6efed3a6b917f2fbaa2bbcf61a2e", "0x91f030cfec606f9ff832aef20f768bf3a129b59c"] , ["0", "0", "0"] , 0xf903558a31303333353134373936b903477b22646570656e64656e63696573223a205b2254312d3e5432222c202254312d3e5433222c202254322d3e5433225d2c2022696e74656e7473223a205b7b22636861696e223a2022636861696e3140687474703a2f2f3132372e302e302e313a38353435222c2022647374223a2022307837303139666137373930323463306130656163316438343735373333656566653130613439663362222c202266756e64223a20223078336538222c2022676173223a202230783439336530222c20226e616d65223a20225431222c2022736f75726365223a2022307834376131636462363539346436656665643361366239313766326662616132626263663631613265222c20227472616e735f74797065223a20227472616e73666572222c2022756e6974223a2022776569227d2c207b22636861696e223a2022636861696e3240687474703a2f2f3132372e302e302e313a38353435222c2022647374223a2022307864303531613433643365613632616666663336333262636133643561626636386263366664373337222c202266756e64223a20223078336538222c2022676173223a202230783439336530222c20226e616d65223a20225432222c2022736f75726365223a2022307839316630333063666563363036663966663833326165663230663736386266336131323962353963222c20227472616e735f74797065223a20227472616e73666572222c2022756e6974223a2022776569227d2c207b2261646472657373223a2022307838353835346665333835336237413531353736624664373835363445633139393366383832306431222c2022636861696e223a2022636861696e3240687474703a2f2f3132372e302e302e313a38353435222c202266756e63223a202269734f776e6572222c2022676173223a202230783439336530222c2022696e766f6b6572223a2022307839316630333063666563363036663966663833326165663230663736386266336131323962353963222c20226e616d65223a20225433222c2022706172616d6574657273223a205b22307837303139666137373930323463306130656163316438343735373333656566653130613439663362225d2c20227472616e735f74797065223a2022696e766f6b65227d5d7d , 0xbe11191bd4ff95dc124130b4d25cbb7c31fcf626a90059c274c2743e7fd42b245286f062e534822d5041725901f604ad0c4ff99d444a669f289bc560b06568551b , 3
# ["0x4f984aa7d262372df92f85af9be8d2df09ac4018","0x47a1cdb6594d6efed3a6b917f2fbaa2bbcf61a2e","0x91f030cfec606f9ff832aef20f768bf3a129b59c"],["0","0","0"],"0xf903558a33303439393837353635b903477b22646570656e64656e63696573223a205b2254312d3e5432222c202254312d3e5433222c202254322d3e5433225d2c2022696e74656e7473223a205b7b22636861696e223a2022636861696e3140687474703a2f2f3132372e302e302e313a38353435222c2022647374223a2022307837303139666137373930323463306130656163316438343735373333656566653130613439663362222c202266756e64223a20223078336538222c2022676173223a202230783439336530222c20226e616d65223a20225431222c2022736f75726365223a2022307834376131636462363539346436656665643361366239313766326662616132626263663631613265222c20227472616e735f74797065223a20227472616e73666572222c2022756e6974223a2022776569227d2c207b22636861696e223a2022636861696e3240687474703a2f2f3132372e302e302e313a38353435222c2022647374223a2022307864303531613433643365613632616666663336333262636133643561626636386263366664373337222c202266756e64223a20223078336538222c2022676173223a202230783439336530222c20226e616d65223a20225432222c2022736f75726365223a2022307839316630333063666563363036663966663833326165663230663736386266336131323962353963222c20227472616e735f74797065223a20227472616e73666572222c2022756e6974223a2022776569227d2c207b2261646472657373223a2022307838353835346665333835336237413531353736624664373835363445633139393366383832306431222c2022636861696e223a2022636861696e3240687474703a2f2f3132372e302e302e313a38353435222c202266756e63223a202269734f776e6572222c2022676173223a202230783439336530222c2022696e766f6b6572223a2022307839316630333063666563363036663966663833326165663230663736386266336131323962353963222c20226e616d65223a20225433222c2022706172616d6574657273223a205b22307837303139666137373930323463306130656163316438343735373333656566653130613439663362225d2c20227472616e735f74797065223a2022696e766f6b65227d5d7d","0x6e056d30fb321eaf0d3d7ea635a3a261f8605772ef9b9c2e26fac3006aaa57f7003b8c09545a98c9050082c3ed9bdece6addd54f2b47580c8b8d6cf231664aec1b","3"